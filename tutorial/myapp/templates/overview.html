{% extends "base.html" %} 
{% block title %}
SQLution - Übersicht
{% endblock %}
{% block content %}


<h3  style="text-align: center; margin: 20px; color: var(--text-secondary)">Übersicht</h3>

<details>
<summary style="text-align: center; cursor: pointer; list-style: none; margin: 20px;" onclick="toggleIcon(this)">
    <h5><i class="far fa-caret-square-right" id="detailsIcon"></i> Datenbank und Projekt verwalten</h5>
</summary>

<div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; width: 100%;">
    <div style="flex: 1; text-align: center;">
        <b> SQLite Datenbank (.db) hochladen: </b>
        <p style="font-size: 0.8em;"> Achtung: Hierdurch wird die aktuelle Datenbank gelöscht!</p>
        <form id="uploadForm" method="post" action="{% url 'upload_db' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <input id="db_file" type="file" name="db_file" accept=".db" required class="btn btn-primary" style="margin-bottom: 10px; cursor: pointer;" onchange="this.form.submit();">
        </form>
    </div>
    <div style="flex: 1; text-align: center;">
        <b> SQLite Datenbank (.db) herunterladen: </b>
        <p style="font-size: 0.8em;"> Es werden keine SQL-Abfragen, Formulare oder das Klassendiagramm heruntergeladen!</p>
        <a href="{% url 'download_db' %}" class="btn btn-primary" style="margin-bottom: 10px; ">Datenbank herunterladen (SQLite)</a>
    </div>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; gap: 20px; width: 100%;">
    <div style="flex: 1; text-align: center;">
        <b> Projekt (.zip) hochladen: </b>
        <p style="font-size: 0.8em;"> Achtung: Hierdurch wird das aktuelle Projekt gelöscht!</p>
        <form id="uploadForm" method="post" action="{% url 'upload_zip' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <input id="zip_file" type="file" name="zip_file" accept=".zip" required class="btn btn-primary" style="margin-bottom: 10px; cursor: pointer;" onchange="this.form.submit();">
        </form>
    </div>
    <div style="flex: 1; text-align: center;">
        <b> Projekt (.zip) herunterladen: </b>
        <p style="font-size: 0.8em;"> Es werden alle SQL-Abfragen, Formulare, das Klassendiagramm und die Datenbank heruntergeladen!</p>
        <a href="{% url 'download_zip' %}" class="btn btn-primary" style="margin-bottom: 10px; ">Projekt herunterladen</a>
    </div>
</div>
</details>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      const fileInput = document.getElementById('db_file');
      const uploadForm = document.getElementById('uploadForm');
  
      /*// Prevent navigating away on dragover
      dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
      });
  
      // Handle the dropped file
      dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        fileInput.files = e.dataTransfer.files;
        uploadForm.submit();
      });*/
    });
  </script>


<script>
function toggleIcon(summary) {
    const details = summary.parentElement;
    const icon = summary.querySelector('#detailsIcon');
    
    // Toggle happens after click, so check the future state
    setTimeout(() => {
        if (details.open) {
            icon.className = 'far fa-caret-square-down';
        } else {
            icon.className = 'far fa-caret-square-right';
        }
    }, 0);
}
</script>


<details>
<summary style="text-align: center; cursor: pointer; list-style: none;  margin: 20px;" onclick="toggleIcon(this)">
    <h5><i class="far fa-caret-square-right" id="detailsIcon"></i> Nutzerfunktionen / gespeicherte SQL-Abfragen</h5>
</summary>


<table border="1" style="width: 100%; border-color: var(--border-color);">
    {% for fkt in functions %}
        <tr>
            <th style="border-color: var(--border-color);">{{fkt.name}}</th>
            <td style="font-size: 0.8em; border-color: var(--border-color);">{{fkt.sql|safe}}</td>
        </tr>
    {% endfor %}
</table>
</details>


<details>
<summary style="text-align: center; cursor: pointer; list-style: none; margin: 20px;" onclick="toggleIcon(this)">
    <h5><i class="far fa-caret-square-right" id="detailsIcon"></i> Tabellen (max. 5 Zeilen pro Tabelle)</h5>
</summary>
<h5 style="text-align: center;"></h5>
<table border="1">
    {% for mod in models %}
        <b>{{ mod.name }}</b>
    <table border="1" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
            <tr>
                {% for col in mod.columns %}
                    <th style="padding-left: 4px;">{{ col }}</th>
                {% endfor %}
            </tr>
            {% for row in mod.rows %}
                <tr>
                    {% for cell in row %}
                        <td style="border-color: var(--border-color); padding-left: 4px;">{{ cell }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>
    {% endfor %}
</details>

<br>  
{% endblock %}

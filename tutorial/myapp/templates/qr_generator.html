{% extends "base.html" %}

{% block content %}

<h2>QR Code Generator</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.content.id_for_label }}">{{ form.content.label }}</label>
            {{ form.content }}
            {% if form.content.help_text %}
                <div class="help-text">{{ form.content.help_text }}</div>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.logo_option.id_for_label }}">{{ form.logo_option.label }}</label>
            {{ form.logo_option }}
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.background_type.id_for_label }}">{{ form.background_type.label }}</label>
            {{ form.background_type }}
            {% if form.background_type.help_text %}
                <div class="help-text">{{ form.background_type.help_text }}</div>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.qr_color.id_for_label }}">{{ form.qr_color.label }}</label>
            <div class="color-input-group">
                {{ form.qr_color }}
                <span>QR Code Farbe</span>
            </div>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.frame_type.id_for_label }}">{{ form.frame_type.label }}</label>
            {{ form.frame_type }}
        </div>
        
        <div class="form-group" id="frame-color-group">
            <label for="{{ form.frame_color.id_for_label }}">{{ form.frame_color.label }}</label>
            <div class="color-input-group">
                {{ form.frame_color }}
                <span>Rahmen Farbe</span>
            </div>
        </div>
    </div>
    
    <div class="form-group" id="custom-logo-group" style="display: none;">
        <label for="{{ form.custom_logo.id_for_label }}">{{ form.custom_logo.label }}</label>
        {{ form.custom_logo }}
        {% if form.custom_logo.help_text %}
            <div class="help-text">{{ form.custom_logo.help_text }}</div>
        {% endif %}
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">QR Code erstellen</button>
    </div>
</form>

<script>
    // Show/hide custom logo upload based on selection
    document.addEventListener('DOMContentLoaded', function() {
        const logoSelect = document.querySelector('select[name="logo_option"]');
        const customLogoGroup = document.getElementById('custom-logo-group');
        const frameSelect = document.querySelector('select[name="frame_type"]');
        const frameColorGroup = document.getElementById('frame-color-group');
        const logoGroup = logoSelect.closest('.form-group');
        
        function toggleCustomLogo() {
            const selectedValue = logoSelect.value;
            if (selectedValue === 'custom') {
                customLogoGroup.style.display = 'block';
            } else {
                customLogoGroup.style.display = 'none';
            }
        }
        
        function toggleFrameColor() {
            const selectedValue = frameSelect.value;
            if (selectedValue === 'none') {
                frameColorGroup.style.opacity = '0.5';
                frameColorGroup.style.pointerEvents = 'none';
            } else {
                frameColorGroup.style.opacity = '1';
                frameColorGroup.style.pointerEvents = 'auto';
            }
        }
        
        function toggleLogoOptions() {
            // Logo options are always enabled for square QR codes
            logoSelect.disabled = false;
            logoGroup.style.opacity = '1';
            toggleCustomLogo(); // Update custom logo visibility
        }
        
        logoSelect.addEventListener('change', toggleCustomLogo);
        frameSelect.addEventListener('change', toggleFrameColor);
        
        // Initial checks
        toggleCustomLogo();
        toggleFrameColor();
        toggleLogoOptions();
    });
</script>

{% if svg_content %}
    <div class="qr-container">
        <div class="qr-svg-container">
            {{ svg_content|safe }}
        </div>
        
        {% if download_ready %}
            <div class="download-section">
                <form method="post" style="margin: 0; display: inline-block;">
                    {% csrf_token %}
                    <input type="hidden" name="qr_content" value="{{ qr_content }}">
                    <input type="hidden" name="logo_option" value="{{ logo_option }}">
                    <input type="hidden" name="qr_color" value="{{ qr_color }}">
                    <input type="hidden" name="background_type" value="{{ background_type }}">
                    <input type="hidden" name="frame_type" value="{{ frame_type }}">
                    <input type="hidden" name="frame_color" value="{{ frame_color }}">
                    <input type="hidden" name="download_format" value="svg">
                    <input type="hidden" name="download" value="true">
                    <button type="submit" class="btn-download">
                        ðŸ“¥ SVG herunterladen
                    </button>
                </form>
            </div>
        {% endif %}
    </div>
{% endif %}

{% endblock %}